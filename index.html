<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CeloraAI | Powered by Element Intelligent</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      transition: background-color 0.5s ease;
      overflow: hidden;
    }
    .glass { backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); }
    .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #6366f144; border-radius: 10px; }
    .dark body { background-color: #050505; color: #f8fafc; }
    body:not(.dark) { background-color: #f8fafc; color: #0f172a; }
    .element-gradient-text {
      background: linear-gradient(to r, #6366F1, #A855F7, #EC4899);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .element-gradient-bg {
      background: linear-gradient(to right, #6366F1, #A855F7, #EC4899);
    }
  </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/client": "https://esm.sh/react-dom@^19.2.3/client",
    "@google/genai": "https://esm.sh/@google/genai@^1.37.0",
    "firebase/app": "https://esm.sh/firebase@10.8.0/app",
    "firebase/auth": "https://esm.sh/firebase@10.8.0/auth",
    "firebase/firestore": "https://esm.sh/firebase@10.8.0/firestore",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "react-router-dom": "https://esm.sh/react-router-dom@^7.12.0"
  }
}
</script>
</head>
<body>
  <div id="root"></div>

  <script type="module">
    import React, { useState, useEffect, useRef, useMemo } from 'react';
    import { createRoot } from 'react-dom/client';
    import { GoogleGenAI } from "@google/genai";
    import { initializeApp } from "firebase/app";
    import { getAuth, signInWithPopup, GoogleAuthProvider, OAuthProvider, onAuthStateChanged, signOut, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "firebase/auth";
    import { getFirestore, doc, setDoc, getDoc, collection, query, where, onSnapshot, addDoc, orderBy, updateDoc, deleteDoc } from "firebase/firestore";

    // ==========================================
    // 1. CONFIGURATION (PASTE YOUR KEYS HERE)
    // ==========================================
    const FIREBASE_CONFIG = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase only if config is provided
    let db, auth;
    try {
      if (FIREBASE_CONFIG.apiKey !== "YOUR_API_KEY") {
        const app = initializeApp(FIREBASE_CONFIG);
        db = getFirestore(app);
        auth = getAuth(app);
      }
    } catch (e) { console.error("Firebase Init Error:", e); }

    // --- TRANSLATIONS ---
    const translations = {
      en: {
        home: "Home", history: "Chats", help: "Help", profile: "Profile", settings: "Settings", products: "Products", logout: "Logout",
        newChat: "New Chat", askCelora: "Ask CeloraAI...", welcome: "Welcome to CeloraAI", poweredBy: "Powered by Element Intelligent",
        language: "Language", appearance: "Appearance", darkMode: "Dark Mode", lightMode: "Light Mode",
        editProfile: "Edit Profile", signOut: "Sign Out", status: "Status", active: "Active",
        copy: "Copy", copied: "Copied!", uploadImage: "Upload Image", loginWelcome: "Join CeloraAI",
        loginSubtitle: "Intelligent interactions start here", fullName: "Full Name", email: "Email Address",
        password: "Password", getStarted: "Get Started", signIn: "Sign In", noAccount: "Don't have an account? Sign up",
        hasAccount: "Already have an account? Sign in", continueWithGoogle: "Continue with Google",
        continueWithApple: "Continue with Apple", or: "or", helpTitle: "Help Centre", helpSubtitle: "Support & Docs",
        gettingStarted: "Getting Started", faqTitle: "FAQs", faq1_q: "What is CeloraAI?", 
        faq1_a: "A flagship conversational engine using advanced neural networks.", faq2_q: "Is my data secure?",
        faq2_a: "Yes, we use enterprise-grade cloud encryption.", personalInfo: "Personal Info",
        accountType: "Account Type", premium: "Premium", deleteChat: "Delete Chat?",
        visionTitle: "The Intelligence Revolution", productDesc: "Innovating human potential through intelligence.",
        writeCreate: "Write & Create", writeCreateDesc: "Draft professional content in seconds.",
        devTitle: "Development", devDesc: "Help with complex code and architecture.",
        innovationTitle: "Innovation", innovationDesc: "Brainstorm unique business ideas."
      },
      ru: {
        home: "Главная", history: "Чаты", help: "Помощь", profile: "Профиль", settings: "Настройки", products: "Продукты", logout: "Выйти",
        newChat: "Новый чат", askCelora: "Спросите CeloraAI...", welcome: "Добро пожаловать", poweredBy: "Создано Element Intelligent",
        language: "Язык", appearance: "Тема", darkMode: "Темная", lightMode: "Светлая",
        editProfile: "Изменить", signOut: "Выйти", status: "Статус", active: "Активен",
        copy: "Копировать", copied: "Готово!", uploadImage: "Загрузить", loginWelcome: "Вход в CeloraAI",
        loginSubtitle: "Интеллект начинается здесь", fullName: "Имя", email: "Эл. почта",
        password: "Пароль", getStarted: "Начать", signIn: "Войти", noAccount: "Нет аккаунта? Регистрация",
        hasAccount: "Есть аккаунт? Войти", continueWithGoogle: "Войти через Google",
        continueWithApple: "Войти через Apple", or: "или", helpTitle: "Центр помощи", helpSubtitle: "Поддержка",
        gettingStarted: "Начало работы", faqTitle: "Вопросы", faq1_q: "Что такое CeloraAI?", 
        faq1_a: "Флагманский ИИ-движок от Element Intelligent.", faq2_q: "Данные в безопасности?",
        faq2_a: "Да, используется облачное шифрование.", personalInfo: "Личные данные",
        accountType: "Тип аккаунта", premium: "Премиум", deleteChat: "Удалить чат?",
        visionTitle: "Революция интеллекта", productDesc: "Инновации человеческого потенциала через интеллект.",
        writeCreate: "Пишите и создавайте", writeCreateDesc: "Набросайте контент за секунды.",
        devTitle: "Разработка", devDesc: "Помощь в коде и архитектуре.",
        innovationTitle: "Инновации", innovationDesc: "Мозговой штурм бизнес-идей."
      },
      uz: {
        home: "Asosiy", history: "Chatlar", help: "Yordam", profile: "Profil", settings: "Sozlamalar", products: "Mahsulotlar", logout: "Chiqish",
        newChat: "Yangi chat", askCelora: "CeloraAI'dan so'rang...", welcome: "Xush kelibsiz", poweredBy: "Element Intelligent mahsuloti",
        language: "Til", appearance: "Ko'rinish", darkMode: "Tun", lightMode: "Kun",
        editProfile: "Tahrirlash", signOut: "Chiqish", status: "Holat", active: "Faol",
        copy: "Nusxa", copied: "Nusxalandi!", uploadImage: "Rasm", loginWelcome: "CeloraAI'ga qo'shiling",
        loginSubtitle: "Intellektual muloqot shu yerda", fullName: "To'liq ism", email: "Email",
        password: "Parol", getStarted: "Boshlash", signIn: "Kirish", noAccount: "Ro'yxatdan o'tish",
        hasAccount: "Kirish", continueWithGoogle: "Google orqali",
        continueWithApple: "Apple orqali", or: "yoki", helpTitle: "Yordam markazi", helpSubtitle: "Hujjatlar",
        gettingStarted: "Boshlash", faqTitle: "Savollar", faq1_q: "CeloraAI nima?", 
        faq1_a: "Element Intelligent flagman AI tizimi.", faq2_q: "Xavfsizlik?",
        faq2_a: "Ha, ma'lumotlar bulutda shifrlanadi.", personalInfo: "Ma'lumotlar",
        accountType: "Turi", premium: "Premium", deleteChat: "O'chirish?",
        visionTitle: "Intellekt inqilobi", productDesc: "Intellekt orqali inson salohiyatini innovatsiya qilish.",
        writeCreate: "Yozish va yaratish", writeCreateDesc: "Professional kontent yaratish.",
        devTitle: "Dasturlash", devDesc: "Kod va arxitektura bo'yicha yordam.",
        innovationTitle: "Innovatsiya", innovationDesc: "Noyob biznes g'oyalar."
      }
    };

    // --- COMPONENTS ---

    const ElementLogo = ({ theme, size = "text-xl" }) => (
      <div className={`${size} font-bold flex items-center space-x-1.5`}>
        <span className={theme === 'dark' ? 'text-white' : 'text-black'}>Element</span>
        <span className="element-gradient-text">Intelligent</span>
      </div>
    );

    const App = () => {
      const [view, setView] = useState('home');
      const [theme, setTheme] = useState(() => localStorage.getItem('theme') || 'dark');
      const [lang, setLang] = useState(() => localStorage.getItem('lang') || 'en');
      const [user, setUser] = useState(null);
      const [sessions, setSessions] = useState([]);
      const [activeChatId, setActiveChatId] = useState(null);
      const [loadingAuth, setLoadingAuth] = useState(true);
      
      const t = translations[lang];

      // Auth state listener
      useEffect(() => {
        if (!auth) { setLoadingAuth(false); return; }
        return onAuthStateChanged(auth, (u) => {
          if (u) {
            setUser({ id: u.uid, name: u.displayName || u.email.split('@')[0], email: u.email, provider: u.providerData[0]?.providerId });
          } else {
            setUser(null);
          }
          setLoadingAuth(false);
        });
      }, []);

      // Real-time Firestore sync for sessions
      useEffect(() => {
        if (!db || !user) {
          // Fallback to localStorage if Firebase not configured
          const saved = JSON.parse(localStorage.getItem('sessions')) || [];
          setSessions(saved);
          return;
        }
        const q = query(collection(db, "chats"), where("userId", "==", user.id), orderBy("updatedAt", "desc"));
        return onSnapshot(q, (snapshot) => {
          const list = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          setSessions(list);
        });
      }, [user]);

      useEffect(() => {
        localStorage.setItem('theme', theme);
        localStorage.setItem('lang', lang);
        if (theme === 'dark') document.documentElement.classList.add('dark');
        else document.documentElement.classList.remove('dark');
      }, [theme, lang]);

      if (loadingAuth) return <div className="h-screen flex items-center justify-center bg-[#050505]"><div className="element-gradient-text font-black text-2xl animate-pulse">Initializing Celora...</div></div>;

      if (!user) return <AuthPage theme={theme} t={t} />;

      return (
        <div className={`flex flex-col md:flex-row h-screen overflow-hidden ${theme === 'dark' ? 'bg-[#050505] text-white' : 'bg-slate-50 text-slate-900'}`}>
          {/* Sidebar */}
          <aside className={`hidden md:flex w-64 glass border-r ${theme === 'dark' ? 'border-slate-800' : 'border-slate-200'} flex-col z-20`}>
            <div className="p-6">
              <ElementLogo theme={theme} />
              <p className="text-[9px] uppercase tracking-[0.2em] text-slate-500 font-bold mt-1">Celora Engine v3.0</p>
            </div>
            <nav className="flex-1 px-4 space-y-1">
              {[
                { id: 'home', label: t.home, icon: 'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6' },
                { id: 'chats', label: t.history, icon: 'M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z' },
                { id: 'products', label: t.products, icon: 'M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4' },
                { id: 'help', label: t.help, icon: 'M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' },
                { id: 'profile', label: t.profile, icon: 'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z' },
                { id: 'settings', label: t.settings, icon: 'M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z' }
              ].map(item => (
                <button key={item.id} onClick={() => setView(item.id)} className={`w-full flex items-center space-x-3 px-4 py-3 rounded-2xl transition-all ${view === item.id ? 'bg-indigo-600/10 text-indigo-500 font-bold' : 'text-slate-500 hover:text-indigo-400'}`}>
                  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d={item.icon} /></svg>
                  <span>{item.label}</span>
                </button>
              ))}
            </nav>
            <div className="p-4 mt-auto">
              <button onClick={() => auth && signOut(auth)} className="w-full py-3 rounded-xl border border-slate-800 text-slate-500 text-xs font-black uppercase tracking-widest hover:text-red-500 hover:border-red-900/30 transition-all">{t.logout}</button>
            </div>
          </aside>

          {/* Main View */}
          <main className="flex-1 relative overflow-hidden pb-16 md:pb-0">
            {view === 'home' && <HomeView sessions={sessions} user={user} activeChatId={activeChatId} setActiveChatId={setActiveChatId} theme={theme} t={t} />}
            {view === 'chats' && <ChatsView sessions={sessions} setActiveChatId={(id) => { setActiveChatId(id); setView('home'); }} theme={theme} t={t} />}
            {view === 'products' && <ProductsView theme={theme} t={t} />}
            {view === 'help' && <HelpView theme={theme} t={t} />}
            {view === 'profile' && <ProfileView user={user} theme={theme} t={t} />}
            {view === 'settings' && <SettingsView theme={theme} setTheme={setTheme} lang={lang} setLang={setLang} t={t} />}
          </main>

          {/* Mobile Nav */}
          <nav className="md:hidden fixed bottom-0 left-0 right-0 h-16 glass border-t border-slate-800 flex items-center justify-around z-50">
            {['home', 'chats', 'help', 'profile', 'settings'].map(v => (
              <button key={v} onClick={() => setView(v)} className={`p-1 flex flex-col items-center justify-center min-w-[50px] ${view === v ? 'text-indigo-500' : 'text-slate-500'}`}>
                <div className="text-[9px] font-black uppercase truncate max-w-full">{t[v] || v}</div>
              </button>
            ))}
          </nav>
        </div>
      );
    };

    // --- SUB-PAGES ---

    const AuthPage = ({ theme, t }) => {
      const [isReg, setIsReg] = useState(true);
      const [formData, setFormData] = useState({ name: '', email: '', password: '' });
      const [error, setError] = useState('');

      const submit = async (e) => {
        e.preventDefault();
        if (!auth) { alert("Firebase is not configured. Please paste your keys at the top of the file."); return; }
        try {
          if (isReg) {
            await createUserWithEmailAndPassword(auth, formData.email, formData.password);
          } else {
            await signInWithEmailAndPassword(auth, formData.email, formData.password);
          }
        } catch (e) { setError(e.message); }
      };

      const social = async (providerName) => {
        if (!auth) return;
        try {
          const provider = providerName === 'google' ? new GoogleAuthProvider() : new OAuthProvider('apple.com');
          await signInWithPopup(auth, provider);
        } catch (e) { setError(e.message); }
      };

      return (
        <div className={`min-h-screen flex flex-col items-center justify-center p-6 transition-all ${theme === 'dark' ? 'bg-[#050505]' : 'bg-slate-50'}`}>
          <div className="mb-10"><ElementLogo theme={theme} size="text-3xl" /></div>
          <div className={`max-w-md w-full glass p-8 rounded-[2.5rem] border ${theme === 'dark' ? 'border-slate-800 bg-[#0a0a0a]/60' : 'border-slate-200 bg-white/60'} shadow-2xl`}>
            <h2 className="text-3xl font-black mb-2 text-center">{isReg ? t.loginWelcome : t.signIn}</h2>
            <p className="text-slate-500 font-medium text-center mb-8">{t.loginSubtitle}</p>
            
            <div className="grid grid-cols-2 gap-3 mb-8">
              <button onClick={() => social('google')} className="flex items-center justify-center space-x-2 py-3 border border-slate-800 rounded-2xl hover:bg-white hover:text-black transition-all font-bold text-xs"><span>Google</span></button>
              <button onClick={() => social('apple')} className="flex items-center justify-center space-x-2 py-3 border border-slate-800 rounded-2xl hover:bg-white hover:text-black transition-all font-bold text-xs"><span>Apple</span></button>
            </div>

            <form onSubmit={submit} className="space-y-4">
              {error && <div className="text-red-500 text-[10px] font-black uppercase text-center">{error}</div>}
              {isReg && <input required type="text" placeholder={t.fullName} className="w-full px-5 py-4 rounded-2xl glass border border-slate-800 bg-transparent" onChange={e => setFormData({...formData, name: e.target.value})} />}
              <input required type="email" placeholder={t.email} className="w-full px-5 py-4 rounded-2xl glass border border-slate-800 bg-transparent" onChange={e => setFormData({...formData, email: e.target.value})} />
              <input required type="password" placeholder={t.password} className="w-full px-5 py-4 rounded-2xl glass border border-slate-800 bg-transparent" onChange={e => setFormData({...formData, password: e.target.value})} />
              <button type="submit" className="w-full py-4 element-gradient-bg text-white rounded-2xl font-black shadow-lg shadow-indigo-500/20">{isReg ? t.getStarted : t.signIn}</button>
            </form>
            <button onClick={() => setIsReg(!isReg)} className="w-full text-center mt-6 text-slate-500 text-xs font-bold">{isReg ? t.hasAccount : t.noAccount}</button>
          </div>
        </div>
      );
    };

    const HomeView = ({ sessions, user, activeChatId, setActiveChatId, theme, t }) => {
      const [input, setInput] = useState('');
      const [isLoading, setIsLoading] = useState(false);
      const [selectedImage, setSelectedImage] = useState(null);
      const endRef = useRef(null);
      const activeSession = useMemo(() => sessions.find(s => s.id === activeChatId), [sessions, activeChatId]);

      useEffect(() => { endRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [activeSession?.messages, isLoading]);

      const sendMessage = async (e) => {
        e?.preventDefault();
        if (!input.trim() && !selectedImage) return;

        const userMsg = { id: Date.now().toString(), role: 'user', content: input, timestamp: Date.now(), image: selectedImage };
        let currentSess = activeSession;

        if (!currentSess) {
          const docRef = await addDoc(collection(db, "chats"), {
            userId: user.id,
            title: input.substring(0, 30) || 'Image Analysis',
            messages: [userMsg],
            updatedAt: Date.now()
          });
          setActiveChatId(docRef.id);
          currentSess = { id: docRef.id, messages: [userMsg] };
        } else {
          const updatedMessages = [...currentSess.messages, userMsg];
          await updateDoc(doc(db, "chats", currentSess.id), {
            messages: updatedMessages,
            updatedAt: Date.now()
          });
        }

        const prompt = input;
        const img = selectedImage;
        setInput(''); setSelectedImage(null); setIsLoading(true);

        try {
          const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
          const history = currentSess.messages.map(m => ({ role: m.role, parts: [{ text: m.content }] }));
          
          let parts = [{ text: prompt || "Describe this image" }];
          if (img) {
            const match = img.match(/^data:(image\/\w+);base64,(.+)$/);
            if (match) parts.push({ inlineData: { mimeType: match[1], data: match[2] } });
          }

          const response = await ai.models.generateContent({
            model: 'gemini-3-flash-preview',
            contents: [...history, { role: 'user', parts }]
          });

          const botMsg = { id: (Date.now() + 1).toString(), role: 'model', content: response.text, timestamp: Date.now() };
          const finalMessages = [...currentSess.messages, userMsg, botMsg];
          await updateDoc(doc(db, "chats", currentSess.id), { messages: finalMessages, updatedAt: Date.now() });
        } catch (err) { console.error(err); } finally { setIsLoading(false); }
      };

      const handleFile = (e) => {
        const f = e.target.files[0];
        if (f) {
          const reader = new FileReader();
          reader.onload = () => setSelectedImage(reader.result);
          reader.readAsDataURL(f);
        }
      };

      return (
        <div className="h-full flex flex-col">
          <header className={`h-16 glass border-b ${theme === 'dark' ? 'border-slate-800' : 'border-slate-200'} flex items-center px-6 justify-between`}>
            <div className="font-bold truncate max-w-xs">{activeSession ? activeSession.title : t.newChat}</div>
            {activeSession && <button onClick={() => setActiveChatId(null)} className="text-[10px] font-black uppercase tracking-widest bg-indigo-600/10 text-indigo-500 px-4 py-1.5 rounded-full transition-all">+ {t.newChat}</button>}
          </header>

          <div className="flex-1 overflow-y-auto p-4 md:p-10 space-y-6">
            {!activeSession && (
              <div className="h-full flex flex-col items-center justify-center text-center max-w-lg mx-auto space-y-8 animate-fade-in">
                <div className="w-20 h-20 rounded-[2rem] element-gradient-bg flex items-center justify-center shadow-2xl">
                  <svg className="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                </div>
                <div><h1 className="text-4xl font-black mb-2">{t.welcome}</h1><p className="text-slate-500 font-bold uppercase tracking-widest text-[10px]">{t.poweredBy}</p></div>
                <div className="grid grid-cols-1 gap-3 w-full">
                  {[t.placeholderPrompt1, t.placeholderPrompt2, t.placeholderPrompt3].map(s => (
                    <button key={s} onClick={() => setInput(s)} className={`p-4 border rounded-[1.5rem] text-sm text-left font-medium hover:border-indigo-500 transition-all ${theme === 'dark' ? 'bg-slate-900/50 border-slate-800' : 'bg-white border-slate-200 shadow-sm'}`}>"{s}"</button>
                  ))}
                </div>
              </div>
            )}
            {activeSession?.messages.map(m => (
              <div key={m.id} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                <div className={`max-w-[85%] p-4 rounded-3xl ${m.role === 'user' ? 'bg-indigo-600 text-white' : `${theme === 'dark' ? 'bg-[#151515] border-slate-800' : 'bg-white border-slate-200 shadow-sm'} border`}`}>
                  {m.image && <img src={m.image} className="rounded-xl mb-3 max-h-64 object-contain" alt="Upload" />}
                  <div className="text-[15px] whitespace-pre-wrap leading-relaxed">{m.content}</div>
                </div>
              </div>
            ))}
            {isLoading && <div className="text-xs font-black uppercase text-indigo-500 animate-pulse tracking-widest">Celora Engine Thinking...</div>}
            <div ref={endRef} />
          </div>

          <div className="p-4 md:p-10">
            <form onSubmit={sendMessage} className="max-w-4xl mx-auto flex items-end space-x-3">
              <label className={`p-4 rounded-2xl border cursor-pointer transition-all ${theme === 'dark' ? 'bg-slate-900 border-slate-800 text-slate-500 hover:text-indigo-400' : 'bg-white border-slate-200 shadow-sm hover:text-indigo-600'}`}><input type="file" className="hidden" accept="image/*" onChange={handleFile} /><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg></label>
              <div className="flex-1 relative">
                {selectedImage && <div className="absolute bottom-full mb-4 left-0 w-20 h-20 rounded-xl overflow-hidden border-2 border-indigo-500 shadow-xl"><img src={selectedImage} className="w-full h-full object-cover" /><button onClick={() => setSelectedImage(null)} className="absolute top-0 right-0 bg-red-500 text-white text-[8px] px-1">X</button></div>}
                <textarea rows="1" value={input} onChange={e => setInput(e.target.value)} placeholder={t.askCelora} className={`w-full px-6 py-4 rounded-2xl border glass focus:outline-none focus:ring-2 focus:ring-indigo-500/30 transition-all font-medium ${theme === 'dark' ? 'bg-slate-900/80 border-slate-800 text-white' : 'bg-white border-slate-200 shadow-sm'}`} onKeyDown={e => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } }} />
              </div>
              <button disabled={isLoading} type="submit" className="p-4 bg-indigo-600 text-white rounded-2xl shadow-xl shadow-indigo-500/20 active:scale-95 transition-all"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" /></svg></button>
            </form>
          </div>
        </div>
      );
    };

    const ChatsView = ({ sessions, setActiveChatId, theme, t }) => (
      <div className="p-6 md:p-12 space-y-10 overflow-y-auto h-full">
        <div className="flex justify-between items-center"><div><h1 className="text-5xl font-black">{t.history}</h1><p className="text-slate-500 font-bold uppercase tracking-[0.3em] text-[10px] mt-2">Cloud Interaction Archive</p></div><button onClick={() => setActiveChatId(null)} className="md:hidden text-[10px] font-black uppercase tracking-widest bg-indigo-600 text-white px-4 py-2 rounded-full">+ {t.newChat}</button></div>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-24">
          {sessions.map(s => (
            <div key={s.id} onClick={() => setActiveChatId(s.id)} className={`group glass p-8 rounded-[2.5rem] border cursor-pointer transition-all hover:scale-[1.02] active:scale-95 relative ${theme === 'dark' ? 'border-slate-800 bg-[#0a0a0a]/60 hover:border-indigo-500/40' : 'border-slate-200 bg-white shadow-xl hover:border-indigo-500/40'}`}>
              <button onClick={async (e) => { e.stopPropagation(); if(confirm(t.deleteChat)) await deleteDoc(doc(db, "chats", s.id)); }} className="absolute top-6 right-6 opacity-0 group-hover:opacity-100 p-2 text-slate-600 hover:text-red-500 transition-all"><svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button>
              <h3 className="text-xl font-black mb-2 truncate pr-10">{s.title || 'Conversation'}</h3>
              <p className="text-slate-500 line-clamp-2 text-sm font-medium">{s.messages[s.messages.length - 1]?.content}</p>
              <div className="mt-8 pt-6 border-t border-slate-800/20 flex justify-between items-center text-[10px] font-black uppercase text-slate-500 tracking-widest"><span>{new Date(s.updatedAt).toLocaleDateString()}</span><span className="bg-indigo-600/10 text-indigo-500 px-3 py-1 rounded-lg">{s.messages.length} msgs</span></div>
            </div>
          ))}
          {sessions.length === 0 && <div className="col-span-full py-20 text-center border-2 border-dashed border-slate-800 rounded-[3rem] text-slate-600 font-bold uppercase tracking-widest">No Cloud Data Found</div>}
        </div>
      </div>
    );

    const HelpView = ({ theme, t }) => (
      <div className="p-6 md:p-12 space-y-12 max-w-4xl mx-auto h-full overflow-y-auto pb-24">
        <div className="text-center"><h1 className="text-5xl font-black mb-4">{t.helpTitle}</h1><p className="text-slate-500 font-medium">{t.helpSubtitle}</p></div>
        <section className="space-y-6"><h2 className="text-2xl font-black border-l-4 border-indigo-600 pl-4">{t.faqTitle}</h2><div className="space-y-4">{[1, 2].map(i => (<details key={i} className={`glass p-6 rounded-3xl border ${theme === 'dark' ? 'border-slate-800 bg-slate-900/40' : 'border-slate-200 bg-white shadow-sm'}`}><summary className="font-bold cursor-pointer text-lg">{t[`faq${i}_q`]}</summary><p className="mt-4 text-slate-500 font-medium leading-relaxed">{t[`faq${i}_a`]}</p></details>))}</div></section>
      </div>
    );

    const ProfileView = ({ user, theme, t }) => (
      <div className="p-6 md:p-20 flex flex-col items-center justify-center space-y-10 h-full overflow-y-auto pb-24">
        <div className={`w-full max-w-md glass p-10 rounded-[3.5rem] border shadow-2xl relative overflow-hidden ${theme === 'dark' ? 'border-slate-800 bg-[#0a0a0a]/80' : 'border-slate-200 bg-white/80'}`}>
          <div className="flex flex-col items-center space-y-8 relative">
            <div className="w-32 h-32 rounded-full bg-gradient-to-tr from-indigo-500 via-purple-500 to-pink-500 p-1"><div className={`w-full h-full rounded-full flex items-center justify-center font-black text-5xl ${theme === 'dark' ? 'bg-[#0a0a0a]' : 'bg-white text-indigo-600'}`}>{user.name.charAt(0).toUpperCase()}</div></div>
            <div className="text-center"><h2 className="text-4xl font-black">{user.name}</h2><p className="text-slate-500 font-bold mt-1">{user.email}</p><div className="inline-block mt-4 px-4 py-1.5 rounded-full border border-slate-800 text-[10px] font-black uppercase tracking-widest text-slate-500">Cloud Account: {user.provider}</div></div>
            <div className="w-full space-y-3 pt-6 border-t border-slate-800/20"><div className="flex justify-between items-center text-xs"><span className="text-slate-500 font-black uppercase tracking-widest">{t.status}</span><span className="text-green-500 font-black flex items-center"><span className="w-2 h-2 bg-green-500 rounded-full mr-2 shadow-lg shadow-green-500/50"></span>{t.active}</span></div><div className="flex justify-between items-center text-xs"><span className="text-slate-500 font-black uppercase tracking-widest">{t.accountType}</span><span className="text-transparent bg-clip-text bg-gradient-to-r from-indigo-500 to-pink-500 font-black">{t.premium}</span></div></div>
            <button className="w-full py-4 element-gradient-bg text-white rounded-2xl font-black shadow-lg shadow-indigo-500/20 active:scale-95 transition-all">{t.editProfile}</button>
          </div>
        </div>
      </div>
    );

    const SettingsView = ({ theme, setTheme, lang, setLang, t }) => (
      <div className="p-6 md:p-12 max-w-2xl mx-auto h-full overflow-y-auto pb-24 space-y-12">
        <h1 className="text-5xl font-black">{t.settings}</h1>
        <div className={`glass p-10 rounded-[3rem] border ${theme === 'dark' ? 'border-slate-800 bg-slate-900/40' : 'border-slate-200 bg-white shadow-xl'} space-y-10`}>
          <section className="space-y-4"><h3 className="text-xs font-black uppercase tracking-widest text-slate-500 pl-2">{t.language}</h3><div className="grid grid-cols-3 gap-3">{[ {id:'en', label: 'English'}, {id:'ru', label: 'Русский'}, {id:'uz', label: "O'zbekcha"} ].map(l => (<button key={l.id} onClick={() => setLang(l.id)} className={`py-3 rounded-2xl border font-black text-xs transition-all ${lang === l.id ? 'bg-indigo-600 border-indigo-600 text-white shadow-lg shadow-indigo-500/20' : 'border-slate-800 text-slate-500 hover:border-indigo-400'}`}>{l.label}</button>)) }</div></section>
          <section className="space-y-4"><h3 className="text-xs font-black uppercase tracking-widest text-slate-500 pl-2">{t.appearance}</h3><button onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')} className={`w-full flex items-center justify-between p-6 rounded-2xl border transition-all ${theme === 'dark' ? 'bg-slate-900 border-slate-800' : 'bg-slate-50 border-slate-200 shadow-sm'}`}><div className="flex items-center space-x-4"><span className="font-black uppercase tracking-widest text-[10px]">{theme === 'dark' ? t.darkMode : t.lightMode}</span></div><div className={`w-12 h-6 rounded-full p-1 transition-all ${theme === 'dark' ? 'bg-indigo-600' : 'bg-slate-300'}`}><div className={`w-4 h-4 bg-white rounded-full transition-transform ${theme === 'dark' ? 'translate-x-6' : 'translate-x-0'}`}></div></div></button></section>
        </div>
      </div>
    );

    const ProductsView = ({ theme, t }) => (
      <div className="p-6 md:p-12 space-y-12 overflow-y-auto h-full pb-24">
        <header className="text-center"><h1 className="text-5xl font-black mb-4">{t.products}</h1><p className="text-slate-500 font-bold text-lg max-w-lg mx-auto leading-relaxed">{t.productDesc}</p></header>
        <div className="p-12 rounded-[3.5rem] element-gradient-bg text-white text-center shadow-2xl space-y-4"><h2 className="text-4xl font-black">Element Systems</h2><p className="font-bold opacity-80">Cloud Infrastructure Enabled</p></div>
      </div>
    );

    createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>